<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProfIS - Professoren-Informationssystem</title>
    <link rel="stylesheet" href="updated-styles.css">
    <style>
        /* Additional styles for new views */
        .form-section {
            background-color: #0d0d0d;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #e4e4e4;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #2a2a2a;
        }

        .form-columns {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-columns.three {
            grid-template-columns: repeat(3, 1fr);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-textarea {
            background-color: #0d0d0d;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 14px;
            color: #e4e4e4;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #b7a5c9;
            background-color: #1a1a1a;
        }

        .tab-navigation {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid #2a2a2a;
        }

        .tab-button {
            background: transparent;
            border: none;
            color: #888;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .tab-button:hover {
            color: #e4e4e4;
        }

        .tab-button.active {
            color: #b7a5c9;
            border-bottom-color: #b7a5c9;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-badge.active {
            background-color: #1a4d2e;
            color: #4ade80;
        }

        .status-badge.pending {
            background-color: #4d3c1a;
            color: #fbbf24;
        }

        .overview-card {
            background-color: #252525;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .overview-card:hover {
            background-color: #2a2a2a;
            border-color: #4a4a4a;
        }

        .overview-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .overview-card-title {
            font-size: 15px;
            font-weight: 600;
            color: #e4e4e4;
        }

        .overview-card-meta {
            font-size: 13px;
            color: #888;
        }

        .overview-card-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .overview-field {
            font-size: 13px;
        }

        .overview-field-label {
            color: #888;
            margin-bottom: 4px;
        }

        .overview-field-value {
            color: #e4e4e4;
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .btn-small {
            padding: 6px 16px;
            font-size: 13px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-edit {
            background-color: #252525;
            border: 1px solid #4a9eff;
            color: #4a9eff;
        }

        .btn-edit:hover {
            background-color: #1a3a5a;
        }

        .btn-select {
            background-color: #b7a5c9;
            color: #ffffff;
        }

        .btn-select:hover {
            background-color: #915aff;
        }
    </style>
</head>

<body>
<!-- Navigation -->
<div class="topnav">
    <a data-view="overview">Übersicht</a>
    <a data-view="students">Studenten</a>
    <a data-view="theses">Arbeiten</a>
    <a data-view="professors">Referenten</a>
    <a data-view="dashboard">Dashboard</a>
</div>

<!-- Main App Container -->
<div id="app"></div>

<!-- Bottom Status Bar -->
<div class="bottom-bar">
    <div class="status-bar">
        <div class="status-indicator"></div>
        <span class="status-text" id="statusText">System bereit</span>
    </div>
</div>

<!-- Modals Container -->
<div id="modals"></div>

<script>
    const API_BASE_URL = 'http://localhost:8080/api';

    const AppState = {
        currentView: 'overview',
        students: [],
        theses: [],
        professors: [],
        selectedStudent: null,
        selectedThesis: null,
        selectedProfessor: null
    };

    // ==================== VIEW MANAGER ====================
    const ViewManager = {
        views: {},

        register(name, viewFunction) {
            this.views[name] = viewFunction;
        },

        render(viewName) {
            if (!this.views[viewName]) {
                console.error(`View ${viewName} not found`);
                return;
            }

            AppState.currentView = viewName;
            const appContainer = document.getElementById('app');
            appContainer.innerHTML = this.views[viewName]();

            document.querySelectorAll('.topnav a').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.view === viewName) {
                    link.classList.add('active');
                }
            });

            const initFn = window[`init${viewName.charAt(0).toUpperCase() + viewName.slice(1)}View`];
            if (initFn) initFn();
        }
    };

    // ==================== OVERVIEW VIEW ====================
    ViewManager.register('overview', () => `
        <div class="view-container">
            <div class="top-bar">
                <button class="action-button" onclick="openAddThesisModal()">
                    <svg viewBox="0 0 24 24">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Neue Arbeit
                </button>
                <input type="text" class="global-search" placeholder="Arbeiten durchsuchen..." oninput="filterOverviewTheses(this.value)">
                <div class="quick-stats">
                    <div class="stat-item">
                        <span>Arbeiten:</span>
                        <span class="stat-value" id="overviewThesesCount">0</span>
                    </div>
                </div>
            </div>
            <div class="main-content">
                <div style="flex: 1; overflow-y: auto; padding: 20px;">
                    <div id="overviewThesesList"></div>
                </div>
            </div>
        </div>
    `);

    // ==================== STUDENTS VIEW ====================
    ViewManager.register('students', () => `
        <div class="view-container">
            <div class="top-bar">
                <button class="action-button" onclick="openAddStudentModal()">
                    <svg viewBox="0 0 24 24">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Neuer Student
                </button>
                <input type="text" class="global-search" placeholder="Studenten durchsuchen..." oninput="filterStudents(this.value)">
                <div class="quick-stats">
                    <div class="stat-item">
                        <span>Studenten:</span>
                        <span class="stat-value" id="totalStudentsCount">0</span>
                    </div>
                </div>
            </div>
            <div class="main-content">
                <div class="details-panel empty" id="studentDetails">
                    Wählen Sie einen Studenten aus der Liste aus oder klicken Sie auf "Neuer Student"
                </div>
                <div class="list-sidebar">
                    <div class="sidebar-header">
                        <div class="sidebar-title">Studenten</div>
                        <div class="sidebar-count" id="visibleStudentsCount">0</div>
                    </div>
                    <div id="studentsList"></div>
                </div>
            </div>
        </div>
    `);

    // ==================== THESES VIEW ====================
    ViewManager.register('theses', () => `
        <div class="view-container">
            <div class="top-bar">
                <button class="action-button" onclick="openAddThesisModal()">
                    <svg viewBox="0 0 24 24">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Neue Arbeit
                </button>
                <input type="text" class="global-search" placeholder="Arbeiten durchsuchen...">
            </div>
            <div class="main-content">
                <div class="details-panel empty" id="thesisDetails">
                    Wählen Sie eine Arbeit aus oder erstellen Sie eine neue
                </div>
                <div class="list-sidebar">
                    <div class="sidebar-header">
                        <div class="sidebar-title">Arbeiten</div>
                        <div class="sidebar-count">0</div>
                    </div>
                </div>
            </div>
        </div>
    `);

    // ==================== PROFESSORS VIEW ====================
    ViewManager.register('professors', () => `
        <div class="view-container">
            <div class="top-bar">
                <button class="action-button" onclick="openAddProfessorModal()">
                    <svg viewBox="0 0 24 24">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Neuer Referent
                </button>
                <input type="text" class="global-search" placeholder="Referenten durchsuchen...">
            </div>
            <div class="main-content">
                <div class="details-panel empty" id="professorDetails">
                    Wählen Sie einen Referenten aus oder erstellen Sie einen neuen
                </div>
                <div class="list-sidebar">
                    <div class="sidebar-header">
                        <div class="sidebar-title">Referenten</div>
                        <div class="sidebar-count">0</div>
                    </div>
                </div>
            </div>
        </div>
    `);

    // ==================== DASHBOARD VIEW ====================
    ViewManager.register('dashboard', () => `
        <div class="view-container">
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>Arbeiten</h3>
                    <div class="dashboard-stat" id="dashThesesCount">0</div>
                    <div class="dashboard-label">Gesamt</div>
                </div>
                <div class="dashboard-card">
                    <h3>Studenten</h3>
                    <div class="dashboard-stat" id="dashStudentsCount">0</div>
                    <div class="dashboard-label">Registriert</div>
                </div>
                <div class="dashboard-card">
                    <h3>Referenten</h3>
                    <div class="dashboard-stat" id="dashProfessorsCount">0</div>
                    <div class="dashboard-label">Aktiv</div>
                </div>
                <div class="dashboard-card">
                    <h3>In Bearbeitung</h3>
                    <div class="dashboard-stat" id="dashActiveCount">0</div>
                    <div class="dashboard-label">Laufende Arbeiten</div>
                </div>
            </div>
        </div>
    `);

    // ==================== VIEW INITIALIZATION ====================

    async function initOverviewView() {
        await loadStudents();
        renderOverviewTheses();
    }

    async function initStudentsView() {
        await loadStudents();
        renderStudentsList(AppState.students);
        updateStudentsStats();
    }

    async function initDashboardView() {
        await loadStudents();
        document.getElementById('dashStudentsCount').textContent = AppState.students.length;
        document.getElementById('dashThesesCount').textContent = 0;
        document.getElementById('dashProfessorsCount').textContent = 0;
        document.getElementById('dashActiveCount').textContent = 0;
    }

    // ==================== API FUNCTIONS ====================

    async function loadStudents() {
        try {
            const response = await fetch(`${API_BASE_URL}/students`);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            AppState.students = await response.json();
            return AppState.students;
        } catch (error) {
            console.error('Error loading students:', error);
            updateStatus('Fehler beim Laden der Studenten');
            return [];
        }
    }

    // ==================== RENDER FUNCTIONS ====================

    function renderOverviewTheses() {
        const container = document.getElementById('overviewThesesList');

        // Mock data for demonstration
        const mockTheses = [
            {
                id: 1,
                student: 'Max Mustermann',
                title: 'Machine Learning Ansätze zur Vorhersage von Softwarefehlern',
                startDate: '2024-10-01',
                submissionDate: '2025-03-01',
                supervisor: 'Prof. Dr. Grüne',
                coSupervisor: 'Dr. Klein',
                colloquiumDate: '2025-03-20',
                status: 'ACTIVE'
            },
            {
                id: 2,
                student: 'Anna Schmidt',
                title: 'Entwicklung eines Webshop-Systems mit React und Node.js',
                startDate: '2024-09-15',
                submissionDate: '2025-02-15',
                supervisor: 'Prof. Dr. Müller',
                coSupervisor: 'Prof. Dr. Wagner',
                colloquiumDate: null,
                status: 'PENDING'
            }
        ];

        container.innerHTML = mockTheses.map(thesis => `
            <div class="overview-card">
                <div class="overview-card-header">
                    <div class="overview-card-title">
                        ${thesis.student}
                        <span class="status-badge ${thesis.status === 'ACTIVE' ? 'active' : 'pending'}">
                            ${thesis.status === 'ACTIVE' ? 'Aktiv' : 'Anstehend'}
                        </span>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-small btn-edit" onclick="editThesis(${thesis.id})">Anlegen/Auswählen</button>
                    </div>
                </div>
                <div class="overview-card-meta">${thesis.title}</div>
                <div class="overview-card-content">
                    <div class="overview-field">
                        <div class="overview-field-label">Startdatum / Semester</div>
                        <div class="overview-field-value">${formatDate(thesis.startDate)}</div>
                    </div>
                    <div class="overview-field">
                        <div class="overview-field-label">Abgabedatum / Semester</div>
                        <div class="overview-field-value">${formatDate(thesis.submissionDate)}</div>
                    </div>
                    <div class="overview-field">
                        <div class="overview-field-label">Referent</div>
                        <div class="overview-field-value">${thesis.supervisor}</div>
                    </div>
                    <div class="overview-field">
                        <div class="overview-field-label">Korreferent</div>
                        <div class="overview-field-value">${thesis.coSupervisor}</div>
                    </div>
                    <div class="overview-field">
                        <div class="overview-field-label">Kolloquiumsdatum / Semester</div>
                        <div class="overview-field-value">${thesis.colloquiumDate ? formatDate(thesis.colloquiumDate) : 'Nicht festgelegt'}</div>
                    </div>
                    <div class="overview-field">
                        <div class="overview-field-label">Note Referent / Korreferent</div>
                        <div class="overview-field-value">- / -</div>
                    </div>
                </div>
            </div>
        `).join('');

        document.getElementById('overviewThesesCount').textContent = mockTheses.length;
    }

    function renderStudentsList(students) {
        const container = document.getElementById('studentsList');
        if (!students || students.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Keine Studenten gefunden</div>';
            return;
        }

        container.innerHTML = students.map(student => `
            <div class="list-item ${AppState.selectedStudent?.matrikelnummer === student.matrikelnummer ? 'active' : ''}" onclick="selectStudent(${student.matrikelnummer})">
                <div class="item-header">
                    <div class="item-badge">Student</div>
                    <div class="item-meta">Mat.-Nr. ${student.matrikelnummer}</div>
                </div>
                <div class="item-title">${student.vorname} ${student.nachname}</div>
                <div class="item-subtitle">${student.mail}</div>
            </div>
        `).join('');
    }

    // ==================== SELECTION FUNCTIONS ====================

    function selectStudent(matrikelnummer) {
        AppState.selectedStudent = AppState.students.find(s => s.matrikelnummer === matrikelnummer);
        renderStudentsList(AppState.students);
        displayStudentDetails(AppState.selectedStudent);
    }

    function displayStudentDetails(student) {
        const container = document.getElementById('studentDetails');
        const initials = student.vorname.charAt(0) + student.nachname.charAt(0);

        container.className = 'details-panel';
        container.innerHTML = `
            <div class="detail-header">
                <div class="detail-icon">${initials}</div>
                <div class="detail-header-info">
                    <h2>${student.vorname} ${student.nachname}</h2>
                    <p>Matrikelnummer: ${student.matrikelnummer}</p>
                </div>
                <div class="detail-actions">
                    <div class="icon-button" onclick="openEditStudentModal(${student.matrikelnummer})" title="Bearbeiten">
                        <svg viewBox="0 0 24 24">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                    </div>
                    <div class="icon-button delete" onclick="deleteStudent(${student.matrikelnummer})" title="Löschen">
                        <svg viewBox="0 0 24 24">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                    </div>
                </div>
            </div>
            <div class="detail-grid">
                <div class="detail-field">
                    <div class="detail-label">Vorname</div>
                    <div class="detail-value">${student.vorname}</div>
                </div>
                <div class="detail-field">
                    <div class="detail-label">Nachname</div>
                    <div class="detail-value">${student.nachname}</div>
                </div>
                <div class="detail-field">
                    <div class="detail-label">Matrikelnummer</div>
                    <div class="detail-value">${student.matrikelnummer}</div>
                </div>
                <div class="detail-field full-width">
                    <div class="detail-label">E-Mail</div>
                    <div class="detail-value">${student.mail}</div>
                </div>
                <div class="detail-field">
                    <div class="detail-label">Studiengang-ID</div>
                    <div class="detail-value">${student.idStudiengang}</div>
                </div>
                <div class="detail-field">
                    <div class="detail-label">Scheinfrei</div>
                    <div class="detail-value">${student.scheinfrei ? 'Ja' : 'Nein'}</div>
                </div>
            </div>
        `;
    }

    // ==================== MODAL FUNCTIONS ====================

    function openAddStudentModal() {
        const modalsContainer = document.getElementById('modals');
        modalsContainer.innerHTML = `
            <div class="modal-overlay active">
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">Studierende/r</div>
                        <div class="modal-close" onclick="closeModal()">
                            <svg viewBox="0 0 24 24">
                                <line x1="6" y1="6" x2="18" y2="18"/>
                                <line x1="18" y1="6" x2="6" y2="18"/>
                            </svg>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div id="errorMessage"></div>
                        <form id="studentForm" onsubmit="submitStudent(event)">
                            <div class="form-section">
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label class="form-label">Studiengang: <NAME, PO-Nr></label>
                                        <input type="text" class="form-input" id="studentProgram" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Matrikelnummer</label>
                                        <input type="text" class="form-input" id="studentMatrikel" placeholder="1234567">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Name</label>
                                        <input type="text" class="form-input" id="studentLastName" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Vorname</label>
                                        <input type="text" class="form-input" id="studentFirstName" required>
                                    </div>
                                    <div class="form-group full-width">
                                        <label class="form-label">Adresse</label>
                                        <textarea class="form-textarea" id="studentAddress" rows="3"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Telefon</label>
                                        <input type="tel" class="form-input" id="studentPhone" placeholder="0123-456789">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">E-Mail *</label>
                                        <input type="email" class="form-input" id="studentEmail" required>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-button cancel" onclick="closeModal()">Cancel</button>
                        <button class="modal-button primary" onclick="document.getElementById('studentForm').requestSubmit()">Submit</button>
                    </div>
                </div>
            </div>
        `;
    }

    function openAddThesisModal() {
        const modalsContainer = document.getElementById('modals');
        modalsContainer.innerHTML = `
            <div class="modal-overlay active">
                <div class="modal">
                    <div class="modal-header">
                        <div class="tab-navigation">
                            <button class="tab-button active" onclick="switchTab('arbeit')">Arbeit</button>
                            <button class="tab-button" onclick="switchTab('stammdaten')">Stammdaten</button>
                        </div>
                        <div class="modal-close" onclick="closeModal()">
                            <svg viewBox="0 0 24 24">
                                <line x1="6" y1="6" x2="18" y2="18"/>
                                <line x1="18" y1="6" x2="6" y2="18"/>
                            </svg>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div id="errorMessage"></div>

                        <!-- Arbeit Tab -->
                        <div id="arbeitTab">
                            <form id="thesisForm" onsubmit="submitThesis(event)">
                                <div class="form-section">
                                    <div class="form-grid">
                                        <div class="form-group full-width">
                                            <label class="form-label">Studiengang: <NAME, PO-Nr></label>
                                            <input type="text" class="form-input" required>
                                        </div>
                                        <div class="form-group full-width">
                                            <label class="form-label">Titel der Arbeit</label>
                                            <textarea class="form-textarea" rows="3" required></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="form-section-title">Arbeit</div>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">Startdatum</label>
                                            <input type="date" class="form-input" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Abgabedatum</label>
                                            <input type="date" class="form-input" required>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="form-section-title">Kolloquium</div>
                                    <div class="form-grid">
                                        <div class="form-group full-width">
                                            <label class="form-label">Kolloquiumsdatum</label>
                                            <input type="date" class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Uhrzeit Kolloquium von:</label>
                                            <input type="time" class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">bis:</label>
                                            <input type="time" class="form-input">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="form-section-title">Referent</div>
                                    <div class="form-grid">
                                        <div class="form-group full-width">
                                            <label class="form-label">Note Arbeit (Referent)</label>
                                            <select class="form-select">
                                                <option value="">Bitte wählen</option>
                                                <option value="1.0">1,0</option>
                                                <option value="1.3">1,3</option>
                                                <option value="1.7">1,7</option>
                                                <option value="2.0">2,0</option>
                                                <option value="2.3">2,3</option>
                                                <option value="2.7">2,7</option>
                                                <option value="3.0">3,0</option>
                                                <option value="3.3">3,3</option>
                                                <option value="3.7">3,7</option>
                                                <option value="4.0">4,0</option>
                                                <option value="5.0">5,0</option>
                                            </select>
                                        </div>
                                        <div class="form-group full-width">
                                            <label class="form-label">Note Kolloquium (Referent)</label>
                                            <select class="form-select">
                                                <option value="">Bitte wählen</option>
                                                <option value="1.0">1,0</option>
                                                <option value="1.3">1,3</option>
                                                <option value="1.7">1,7</option>
                                                <option value="2.0">2,0</option>
                                                <option value="2.3">2,3</option>
                                                <option value="2.7">2,7</option>
                                                <option value="3.0">3,0</option>
                                                <option value="3.3">3,3</option>
                                                <option value="3.7">3,7</option>
                                                <option value="4.0">4,0</option>
                                                <option value="5.0">5,0</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="form-section-title">Korreferent</div>
                                    <div class="form-grid">
                                        <div class="form-group full-width">
                                            <label class="form-label">Note Arbeit (Korreferent)</label>
                                            <select class="form-select">
                                                <option value="">Bitte wählen</option>
                                                <option value="1.0">1,0</option>
                                                <option value="1.3">1,3</option>
                                                <option value="1.7">1,7</option>
                                                <option value="2.0">2,0</option>
                                                <option value="2.3">2,3</option>
                                                <option value="2.7">2,7</option>
                                                <option value="3.0">3,0</option>
                                                <option value="3.3">3,3</option>
                                                <option value="3.7">3,7</option>
                                                <option value="4.0">4,0</option>
                                                <option value="5.0">5,0</option>
                                            </select>
                                        </div>
                                        <div class="form-group full-width">
                                            <label class="form-label">Note Kolloquium (Korreferent)</label>
                                            <select class="form-select">
                                                <option value="">Bitte wählen</option>
                                                <option value="1.0">1,0</option>
                                                <option value="1.3">1,3</option>
                                                <option value="1.7">1,7</option>
                                                <option value="2.0">2,0</option>
                                                <option value="2.3">2,3</option>
                                                <option value="2.7">2,7</option>
                                                <option value="3.0">3,0</option>
                                                <option value="3.3">3,3</option>
                                                <option value="3.7">3,7</option>
                                                <option value="4.0">4,0</option>
                                                <option value="5.0">5,0</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="form-section-title">Gesamtnote</div>
                                    <div class="form-grid">
                                        <div class="form-group full-width">
                                            <label class="form-label">Berechnete Note nach PO</label>
                                            <input type="text" class="form-input" readonly value="-">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <!-- Stammdaten Tab -->
                        <div id="stammdatenTab" style="display: none;">
                            <div class="form-section">
                                <div class="form-section-title">Student/in</div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Vorname</label>
                                        <input type="text" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Nachname</label>
                                        <input type="text" class="form-input">
                                    </div>
                                    <div class="form-group full-width">
                                        <label class="form-label">E-Mail</label>
                                        <input type="email" class="form-input">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <div class="form-section-title">Referent/in</div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Titel</label>
                                        <select class="form-select">
                                            <option value="">Bitte wählen</option>
                                            <option value="prof-dr">Prof. Dr.</option>
                                            <option value="dr">Dr.</option>
                                            <option value="prof">Prof.</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Name</label>
                                        <input type="text" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Vorname</label>
                                        <input type="text" class="form-input">
                                    </div>
                                    <div class="form-group full-width">
                                        <label class="form-label">Adresse</label>
                                        <textarea class="form-textarea" rows="3"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Telefon</label>
                                        <input type="tel" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">E-Mail</label>
                                        <input type="email" class="form-input">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <div class="form-section-title">Korreferent/in</div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Titel</label>
                                        <select class="form-select">
                                            <option value="">Bitte wählen</option>
                                            <option value="prof-dr">Prof. Dr.</option>
                                            <option value="dr">Dr.</option>
                                            <option value="prof">Prof.</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Name</label>
                                        <input type="text" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Vorname</label>
                                        <input type="text" class="form-input">
                                    </div>
                                    <div class="form-group full-width">
                                        <label class="form-label">Adresse</label>
                                        <textarea class="form-textarea" rows="3"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Telefon</label>
                                        <input type="tel" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">E-Mail</label>
                                        <input type="email" class="form-input">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-button cancel" onclick="closeModal()">Cancel</button>
                        <button class="modal-button primary" onclick="submitThesisForm()">Submit</button>
                    </div>
                </div>
            </div>
        `;
    }

    function openAddProfessorModal() {
        const modalsContainer = document.getElementById('modals');
        modalsContainer.innerHTML = `
            <div class="modal-overlay active">
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">Referent/in</div>
                        <div class="modal-close" onclick="closeModal()">
                            <svg viewBox="0 0 24 24">
                                <line x1="6" y1="6" x2="18" y2="18"/>
                                <line x1="18" y1="6" x2="6" y2="18"/>
                            </svg>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div id="errorMessage"></div>
                        <form id="professorForm" onsubmit="submitProfessor(event)">
                            <div class="form-section">
                                <div style="text-align: center; margin-bottom: 20px;">
                                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #744aff, #756bff); border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center;">
                                        <svg viewBox="0 0 24 24" style="width: 40px; height: 40px; stroke: #fff; fill: none; stroke-width: 2;">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                            <circle cx="12" cy="7" r="4"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label class="form-label">Titel</label>
                                        <select class="form-select" id="professorTitle">
                                            <option value="">Bitte wählen</option>
                                            <option value="prof-dr">Prof. Dr.</option>
                                            <option value="dr">Dr.</option>
                                            <option value="prof">Prof.</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Name *</label>
                                        <input type="text" class="form-input" id="professorLastName" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Vorname *</label>
                                        <input type="text" class="form-input" id="professorFirstName" required>
                                    </div>
                                    <div class="form-group full-width">
                                        <label class="form-label">Adresse</label>
                                        <textarea class="form-textarea" id="professorAddress" rows="3"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Telefon *</label>
                                        <input type="tel" class="form-input" id="professorPhone" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">E-Mail *</label>
                                        <input type="email" class="form-input" id="professorEmail" required>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-button cancel" onclick="closeModal()">Cancel</button>
                        <button class="modal-button primary" onclick="document.getElementById('professorForm').requestSubmit()">Submit</button>
                    </div>
                </div>
            </div>
        `;
    }

    function openColloquiumProtocolModal() {
        const modalsContainer = document.getElementById('modals');
        modalsContainer.innerHTML = `
            <div class="modal-overlay active">
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">Kolloquiumsprotokoll</div>
                        <div class="modal-close" onclick="closeModal()">
                            <svg viewBox="0 0 24 24">
                                <line x1="6" y1="6" x2="18" y2="18"/>
                                <line x1="18" y1="6" x2="6" y2="18"/>
                            </svg>
                        </div>
                    </div>
                    <div class="modal-body">
                        <form id="protocolForm" onsubmit="submitProtocol(event)">
                            <div class="form-section">
                                <div class="form-grid">
                                    <div class="form-group full-width" style="background: #1a3a5a; padding: 16px; border-radius: 8px;">
                                        <div style="font-weight: 600; margin-bottom: 8px;">Student/in: <Mat-Nr.>, <VORNAME>, <NACHNAME></div>
                                        <div>Titel der Arbeit: <TITEL></div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Kolloquiumsdatum</label>
                                        <input type="date" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Präsentation von:</label>
                                        <input type="time" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">bis:</label>
                                        <input type="time" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Beginn (Uhrzeit)</label>
                                        <input type="time" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Diskussion von:</label>
                                        <input type="time" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">bis:</label>
                                        <input type="time" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Ende (Uhrzeit)</label>
                                        <input type="time" class="form-input">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <div class="form-section-title">Benotung</div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Note Referent</label>
                                        <select class="form-select">
                                            <option value="">Bitte wählen</option>
                                            <option value="1.0">1,0</option>
                                            <option value="1.3">1,3</option>
                                            <option value="1.7">1,7</option>
                                            <option value="2.0">2,0</option>
                                            <option value="2.3">2,3</option>
                                            <option value="2.7">2,7</option>
                                            <option value="3.0">3,0</option>
                                            <option value="3.3">3,3</option>
                                            <option value="3.7">3,7</option>
                                            <option value="4.0">4,0</option>
                                            <option value="5.0">5,0</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Note Korreferent</label>
                                        <select class="form-select">
                                            <option value="">Bitte wählen</option>
                                            <option value="1.0">1,0</option>
                                            <option value="1.3">1,3</option>
                                            <option value="1.7">1,7</option>
                                            <option value="2.0">2,0</option>
                                            <option value="2.3">2,3</option>
                                            <option value="2.7">2,7</option>
                                            <option value="3.0">3,0</option>
                                            <option value="3.3">3,3</option>
                                            <option value="3.7">3,7</option>
                                            <option value="4.0">4,0</option>
                                            <option value="5.0">5,0</option>
                                        </select>
                                    </div>
                                    <div class="form-group full-width">
                                        <label class="form-label">Protokoll</label>
                                        <textarea class="form-textarea" rows="6" placeholder="Hier Notizen zum Kolloquium eintragen..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-button cancel" onclick="closeModal()">Cancel</button>
                        <button class="modal-button primary" onclick="document.getElementById('protocolForm').requestSubmit()">Submit</button>
                    </div>
                </div>
            </div>
        `;
    }

    function switchTab(tabName) {
        const arbeitTab = document.getElementById('arbeitTab');
        const stammdatenTab = document.getElementById('stammdatenTab');
        const buttons = document.querySelectorAll('.tab-button');

        buttons.forEach(btn => btn.classList.remove('active'));

        if (tabName === 'arbeit') {
            arbeitTab.style.display = 'block';
            stammdatenTab.style.display = 'none';
            buttons[0].classList.add('active');
        } else {
            arbeitTab.style.display = 'none';
            stammdatenTab.style.display = 'block';
            buttons[1].classList.add('active');
        }
    }

    function closeModal() {
        document.getElementById('modals').innerHTML = '';
    }

    // ==================== SUBMIT FUNCTIONS ====================

    async function submitStudent(event) {
        event.preventDefault();

        const newStudent = {
            vorname: document.getElementById('studentFirstName').value,
            nachname: document.getElementById('studentLastName').value,
            mail: document.getElementById('studentEmail').value,
            scheinfrei: false,
            idStudiengang: 1 // Default value
        };

        try {
            const response = await fetch(`${API_BASE_URL}/students`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newStudent)
            });

            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

            await loadStudents();
            renderStudentsList(AppState.students);
            updateStudentsStats();
            closeModal();
            updateStatus('Student erfolgreich angelegt');
        } catch (error) {
            console.error('Error creating student:', error);
            document.getElementById('errorMessage').innerHTML = `<div class="error-message">${error.message}</div>`;
        }
    }

    async function submitThesisForm() {
        // Implement thesis submission
        updateStatus('Arbeit wird gespeichert...');
        closeModal();
        updateStatus('Arbeit erfolgreich angelegt');
    }

    async function submitProfessor(event) {
        event.preventDefault();
        // Implement professor submission
        updateStatus('Referent wird gespeichert...');
        closeModal();
        updateStatus('Referent erfolgreich angelegt');
    }

    async function submitProtocol(event) {
        event.preventDefault();
        // Implement protocol submission
        updateStatus('Protokoll wird gespeichert...');
        closeModal();
        updateStatus('Protokoll erfolgreich gespeichert');
    }

    async function deleteStudent(matrikelnummer) {
        if (!confirm('Student wirklich löschen?')) return;

        try {
            const response = await fetch(`${API_BASE_URL}/students/${matrikelnummer}`, {
                method: 'DELETE'
            });

            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

            await loadStudents();
            renderStudentsList(AppState.students);
            updateStudentsStats();
            document.getElementById('studentDetails').className = 'details-panel empty';
            document.getElementById('studentDetails').textContent = 'Wählen Sie einen Studenten aus der Liste aus';
            updateStatus('Student gelöscht');
        } catch (error) {
            console.error('Error deleting student:', error);
            alert('Fehler beim Löschen: ' + error.message);
        }
    }

    function openEditStudentModal(matrikelnummer) {
        // Implement edit functionality
        alert('Bearbeiten-Funktion wird implementiert für Student: ' + matrikelnummer);
    }

    function editThesis(id) {
        openAddThesisModal();
    }

    // ==================== FILTER FUNCTIONS ====================

    function filterStudents(searchTerm) {
        let filtered = AppState.students;
        if (searchTerm) {
            filtered = AppState.students.filter(s =>
                `${s.vorname} ${s.nachname}`.toLowerCase().includes(searchTerm.toLowerCase()) ||
                s.mail.toLowerCase().includes(searchTerm.toLowerCase())
            );
        }
        renderStudentsList(filtered);
        document.getElementById('visibleStudentsCount').textContent = filtered.length;
    }

    function filterOverviewTheses(searchTerm) {
        renderOverviewTheses();
    }

    // ==================== UTILITY FUNCTIONS ====================

    function updateStudentsStats() {
        document.getElementById('totalStudentsCount').textContent = AppState.students.length;
        document.getElementById('visibleStudentsCount').textContent = AppState.students.length;
    }

    function updateStatus(message) {
        const now = new Date();
        const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        document.getElementById('statusText').textContent = `${message} | ${timeStr} Uhr`;
    }

    function formatDate(dateString) {
        if (!dateString) return '-';
        const date = new Date(dateString);
        return date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
    }

    // ==================== NAVIGATION ====================

    document.addEventListener('click', e => {
        const link = e.target.closest('[data-view]');
        if (!link) return;

        e.preventDefault();
        const viewName = link.dataset.view;
        if (!viewName) return;

        ViewManager.render(viewName);
    });

    // ==================== INITIALIZATION ====================

    ViewManager.render('overview');
</script>
</body>
</html>