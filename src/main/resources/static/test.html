<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProfIS - Professoren-Informationssystem</title>
    <link rel="stylesheet" href="updated-styles.css">
</head>

<body>
    <!-- Navigation -->
    <div class="topnav">
        
        <a class="active" data-view="dashboard">Übersicht</a>
        <a data-view="students">Studenten</a>
        <a data-view="theses">Arbeiten</a>
        <a data-view="professors">Professoren</a>
        <a data-view="">⚙️</a>

    </div>

    <!-- Main App Container -->
    <div id="app"></div>

    <!-- Bottom Status Bar -->
    <div class="bottom-bar">
        <div class="status-bar">
            <div class="status-indicator"></div>
            <span class="status-text" id="statusText">System bereit</span>
        </div>
    </div>

    <!-- Modals Container -->
    <div id="modals"> </div>

    <script>
        // ==================== CONFIGURATION ====================
        const API_BASE_URL = 'http://localhost:8080/api';

        // ==================== STATE MANAGEMENT ====================
        const AppState = {
            currentView: 'dashboard',
            students: [],
            theses: [],
            professors: [],
            selectedStudent: null,
            selectedThesis: null,
            selectedProfessor: null
        };

        // ==================== VIEW MANAGER ====================
        const ViewManager = {
            views: {},

            register(name, viewFunction) {
                this.views[name] = viewFunction;
            },

            render(viewName) {
                if (!this.views[viewName]) {
                    console.error(`View ${viewName} not found`);
                    return;
                }

                AppState.currentView = viewName;
                const appContainer = document.getElementById('app');
                appContainer.innerHTML = this.views[viewName]();

                // Update navigation
                document.querySelectorAll('.topnav a').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.view === viewName) {
                        link.classList.add('active');
                    }
                });

                // Call view-specific init if exists
                const initFn = window[`init${viewName.charAt(0).toUpperCase() + viewName.slice(1)}View`];
                if (initFn) initFn();
            }
        };

        // ==================== VIEWS ====================

        // Dashboard View
        ViewManager.register('dashboard', () => `
            <div class="view-container">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3><a data-view="theses"> Arbeiten </a></h3>
                        <div class="dashboard-stat" id="dashThesesCount">0</div>
                        <div class="dashboard-label">Gesamt</div>
                    </div>
                    <div class="dashboard-card">
                        <h3><a data-view="students"> Studenten</a></h3>
                        <div class="dashboard-stat" id="dashStudentsCount">0</div>
                        <div class="dashboard-label">Registriert</div>
                    </div>
                    <div class="dashboard-card">
                        <h3><a data-view="professors"> Professoren</a></h3>
                        <div class="dashboard-stat" id="dashProfessorsCount">0</div>
                        <div class="dashboard-label">Aktiv</div>
                    </div>
                    <div class="dashboard-card">
                        <h3>  In Bearbeitung</h3>
                        <div class="dashboard-stat" id="dashActiveCount">0</div>
                        <div class="dashboard-label">Laufende Arbeiten</div>
                    </div>
                </div>
            </div>
        `);

        // Students View
        ViewManager.register('students', () => `
            <div class="view-container">
                <div class="top-bar">
                    <button class="action-button" onclick="openAddStudentModal()">
                        <svg viewBox="0 0 24 24">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Neuer Student
                    </button>
                    <input type="text" class="global-search" placeholder="Studenten durchsuchen..." oninput="filterStudents(this.value)">
                    <div class="quick-stats">
                        <div class="stat-item">
                            <span>Studenten:</span>
                            <span class="stat-value" id="totalStudentsCount">0</span>
                        </div>
                    </div>
                </div>
                <div class="main-content">
                    <div class="details-panel empty" id="studentDetails">
                        Wählen Sie einen Studenten aus der Liste aus
                    </div>
                    <div class="list-sidebar">
                        <div class="sidebar-header">
                            <div class="sidebar-title">Studenten</div>
                            <div class="sidebar-count" id="visibleStudentsCount">0</div>
                        </div>
                        <div id="studentsList"></div>
                    </div>
                </div>
            </div>
        `);

        // Theses View
        ViewManager.register('theses', () => `
            <div class="view-container">
                <div class="top-bar">
                    <button class="action-button" onclick="openAddThesisModal()">
                        <svg viewBox="0 0 24 24">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Neue Arbeit
                    </button>
                    <input type="text" class="global-search" placeholder="Arbeiten durchsuchen..." oninput="filterTheses(this.value)">
                    <div class="quick-stats">
                        <div class="stat-item">
                            <span>Arbeiten:</span>
                            <span class="stat-value" id="totalThesesCount">0</span>
                        </div>
                    </div>
                </div>
                <div class="main-content">
                    <div class="details-panel empty" id="thesisDetails">
                        Wählen Sie eine Arbeit aus der Liste aus
                    </div>
                    <div class="list-sidebar">
                        <div class="sidebar-header">
                            <div class="sidebar-title">Arbeiten</div>
                            <div class="sidebar-count" id="visibleThesesCount">0</div>
                        </div>
                        <div id="thesesList"></div>
                    </div>
                </div>
            </div>
        `);

        // Professors View
        ViewManager.register('professors', () => `
            <div class="view-container">
                <div class="top-bar">
                    <button class="action-button" onclick="openAddProfessorModal()">
                        <svg viewBox="0 0 24 24">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Neuer Professor
                    </button>
                    <input type="text" class="global-search" placeholder="Professoren durchsuchen..." oninput="filterProfessors(this.value)">
                    <div class="quick-stats">
                        <div class="stat-item">
                            <span>Professoren:</span>
                            <span class="stat-value" id="totalProfessorsCount">0</span>
                        </div>
                    </div>
                </div>
                <div class="main-content">
                    <div class="details-panel empty" id="professorDetails">
                        Wählen Sie einen Professor aus der Liste aus
                    </div>
                    <div class="list-sidebar">
                        <div class="sidebar-header">
                            <div class="sidebar-title">Professoren</div>
                            <div class="sidebar-count" id="visibleProfessorsCount">0</div>
                        </div>
                        <div id="professorsList"></div>
                    </div>
                </div>
            </div>
        `);

        // ==================== VIEW INITIALIZATION ====================

        async function initDashboardView() {
            // Load all data for dashboard
            try {
                await Promise.all([
                    loadStudents(),
                    loadTheses(),
                    loadProfessors()
                ]);

                document.getElementById('dashStudentsCount').textContent = AppState.students.length;
                document.getElementById('dashThesesCount').textContent = AppState.theses.length;
                document.getElementById('dashProfessorsCount').textContent = AppState.professors.length;
                document.getElementById('dashActiveCount').textContent = AppState.theses.filter(t => t.status === 'IN_PROGRESS').length;
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        async function initStudentsView() {
            await loadStudents();
            renderStudentsList(AppState.students);
            updateStudentsStats();
        }

        async function initThesesView() {
            await loadTheses();
            renderThesesList(AppState.theses);
            updateThesesStats();
        }

        async function initProfessorsView() {
            await loadProfessors();
            renderProfessorsList(AppState.professors);
            updateProfessorsStats();
        }

        // ==================== API FUNCTIONS ====================

        async function loadStudents() {
            try {
                const response = await fetch(`${API_BASE_URL}/students`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                AppState.students = await response.json();
                return AppState.students;
            } catch (error) {
                console.error('Error loading students:', error);
                updateStatus('Fehler beim Laden der Studenten');
                return [];
            }
        }

        async function loadTheses() {
            // Mock data for now
            AppState.theses = [
                { id: 1, title: 'ML für Softwarefehler', student: 'Max Weber', status: 'IN_PROGRESS', type: 'Master' },
                { id: 2, title: 'Webshop mit React', student: 'Anna Schmidt', status: 'SUBMITTED', type: 'Bachelor' }
            ];
            return AppState.theses;
        }

        async function loadProfessors() {
            // Mock data for now
            AppState.professors = [
                { id: 1, name: 'Prof. Dr. Grüne', email: 'gruene@th-mittelhessen.de', activeTheses: 5 },
                { id: 2, name: 'Prof. Dr. Müller', email: 'mueller@th-mittelhessen.de', activeTheses: 3 }
            ];
            return AppState.professors;
        }

        // ==================== RENDER FUNCTIONS ====================

        function renderStudentsList(students) {
            const container = document.getElementById('studentsList');
            if (!students || students.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Keine Studenten gefunden</div>';
                return;
            }

            container.innerHTML = students.map(student => `
                <div class="list-item ${AppState.selectedStudent?.matrikelnummer === student.matrikelnummer ? 'active' : ''}" onclick="selectStudent(${student.matrikelnummer})">
                    <div class="item-header">
                        <div class="item-badge">Student</div>
                        <div class="item-meta">Mat.-Nr. ${student.matrikelnummer}</div>
                    </div>
                    <div class="item-title">${student.vorname} ${student.nachname}</div>
                    <div class="item-subtitle">${student.mail}</div>
                </div>
            `).join('');
        }

        function renderThesesList(theses) {
            const container = document.getElementById('thesesList');
            if (!theses || theses.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Keine Arbeiten gefunden</div>';
                return;
            }

            container.innerHTML = theses.map(thesis => `
                <div class="list-item ${AppState.selectedThesis?.id === thesis.id ? 'active' : ''}" onclick="selectThesis(${thesis.id})">
                    <div class="item-header">
                        <div class="item-badge">${thesis.type}</div>
                        <div class="item-meta">${thesis.status}</div>
                    </div>
                    <div class="item-title">${thesis.student}</div>
                    <div class="item-subtitle">${thesis.title}</div>
                </div>
            `).join('');
        }

        function renderProfessorsList(professors) {
            const container = document.getElementById('professorsList');
            if (!professors || professors.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Keine Professoren gefunden</div>';
                return;
            }

            container.innerHTML = professors.map(prof => `
                <div class="list-item ${AppState.selectedProfessor?.id === prof.id ? 'active' : ''}" onclick="selectProfessor(${prof.id})">
                    <div class="item-header">
                        <div class="item-badge">Professor</div>
                        <div class="item-meta">${prof.activeTheses} Arbeiten</div>
                    </div>
                    <div class="item-title">${prof.name}</div>
                    <div class="item-subtitle">${prof.email}</div>
                </div>
            `).join('');
        }

        // ==================== SELECTION FUNCTIONS ====================

        function selectStudent(matrikelnummer) {
            AppState.selectedStudent = AppState.students.find(s => s.matrikelnummer === matrikelnummer);
            renderStudentsList(AppState.students);
            displayStudentDetails(AppState.selectedStudent);
        }

        function selectThesis(id) {
            AppState.selectedThesis = AppState.theses.find(t => t.id === id);
            renderThesesList(AppState.theses);
            displayThesisDetails(AppState.selectedThesis);
        }

        function selectProfessor(id) {
            AppState.selectedProfessor = AppState.professors.find(p => p.id === id);
            renderProfessorsList(AppState.professors);
            displayProfessorDetails(AppState.selectedProfessor);
        }

        // ==================== DISPLAY DETAILS ====================

        function displayStudentDetails(student) {
            const container = document.getElementById('studentDetails');
            const initials = student.vorname.charAt(0) + student.nachname.charAt(0);

            container.className = 'details-panel';
            container.innerHTML = `
                <div class="detail-header">
                    <div class="detail-icon">${initials}</div>
                    <div class="detail-header-info">
                        <h2>${student.vorname} ${student.nachname}</h2>
                        <p>Matrikelnummer: ${student.matrikelnummer}</p>
                    </div>
                    <div class="detail-actions">
                        <div class="icon-button delete" onclick="deleteStudent(${student.matrikelnummer})" title="Löschen">
                            <svg viewBox="0 0 24 24">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="detail-grid">
                    <div class="detail-field">
                        <div class="detail-label">Vorname</div>
                        <div class="detail-value">${student.vorname}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Nachname</div>
                        <div class="detail-value">${student.nachname}</div>
                    </div>
                    <div class="detail-field full-width">
                        <div class="detail-label">E-Mail</div>
                        <div class="detail-value">${student.mail}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Studiengang-ID</div>
                        <div class="detail-value">${student.idStudiengang}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Scheinfrei</div>
                        <div class="detail-value">${student.scheinfrei ? 'Ja' : 'Nein'}</div>
                    </div>
                </div>
            `;
        }

        function displayThesisDetails(thesis) {
            const container = document.getElementById('thesisDetails');
            container.className = 'details-panel';
            container.innerHTML = `
                <div class="detail-header">
                    <div class="detail-icon">${thesis.type.charAt(0)}</div>
                    <div class="detail-header-info">
                        <h2>${thesis.student}</h2>
                        <p>${thesis.type}arbeit</p>
                    </div>
                </div>
                <div class="detail-grid">
                    <div class="detail-field full-width">
                        <div class="detail-label">Titel</div>
                        <div class="detail-value">${thesis.title}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">${thesis.status}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Typ</div>
                        <div class="detail-value">${thesis.type}</div>
                    </div>
                </div>
            `;
        }

        function displayProfessorDetails(prof) {
            const container = document.getElementById('professorDetails');
            const initials = prof.name.split(' ').map(n => n.charAt(0)).join('');

            container.className = 'details-panel';
            container.innerHTML = `
                <div class="detail-header">
                    <div class="detail-icon">${initials}</div>
                    <div class="detail-header-info">
                        <h2>${prof.name}</h2>
                        <p>${prof.activeTheses} aktive Arbeiten</p>
                    </div>
                </div>
                <div class="detail-grid">
                    <div class="detail-field">
                        <div class="detail-label">Name</div>
                        <div class="detail-value">${prof.name}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">E-Mail</div>
                        <div class="detail-value">${prof.email}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Aktive Arbeiten</div>
                        <div class="detail-value">${prof.activeTheses}</div>
                    </div>
                </div>
            `;
        }

        // ==================== FILTER FUNCTIONS ====================

        function filterStudents(searchTerm) {
            let filtered = AppState.students;
            if (searchTerm) {
                filtered = AppState.students.filter(s =>
                    `${s.vorname} ${s.nachname}`.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    s.mail.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            renderStudentsList(filtered);
            document.getElementById('visibleStudentsCount').textContent = filtered.length;
        }

        function filterTheses(searchTerm) {
            let filtered = AppState.theses;
            if (searchTerm) {
                filtered = AppState.theses.filter(t =>
                    t.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    t.student.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            renderThesesList(filtered);
            document.getElementById('visibleThesesCount').textContent = filtered.length;
        }

        function filterProfessors(searchTerm) {
            let filtered = AppState.professors;
            if (searchTerm) {
                filtered = AppState.professors.filter(p =>
                    p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    p.email.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            renderProfessorsList(filtered);
            document.getElementById('visibleProfessorsCount').textContent = filtered.length;
        }

        // ==================== STATS UPDATES ====================

        function updateStudentsStats() {
            document.getElementById('totalStudentsCount').textContent = AppState.students.length;
            document.getElementById('visibleStudentsCount').textContent = AppState.students.length;
        }

        function updateThesesStats() {
            document.getElementById('totalThesesCount').textContent = AppState.theses.length;
            document.getElementById('visibleThesesCount').textContent = AppState.theses.length;
        }

        function updateProfessorsStats() {
            document.getElementById('totalProfessorsCount').textContent = AppState.professors.length;
            document.getElementById('visibleProfessorsCount').textContent = AppState.professors.length;
        }

        // ==================== MODAL FUNCTIONS ====================

        function openAddStudentModal() {
            const modalsContainer = document.getElementById('modals');
            modalsContainer.innerHTML = `
                <div class="modal-overlay active" id="addStudentModal">
                    <div class="modal">
                        <div class="modal-header">
                            <div class="modal-title">Neuen Studenten anlegen</div>
                            <div class="modal-close" onclick="closeModal('addStudentModal')">
                                <svg viewBox="0 0 24 24">
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                </svg>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div id="errorMessage"></div>
                            <form id="addStudentForm" onsubmit="submitNewStudent(event)">
                                <div class="form-grid">
                                    <div class="form-field">
                                        <label class="form-label">Vorname *</label>
                                        <input type="text" class="form-input" id="studentFirstName" required>
                                    </div>
                                    <div class="form-field">
                                        <label class="form-label">Nachname *</label>
                                        <input type="text" class="form-input" id="studentLastName" required>
                                    </div>
                                    <div class="form-field full-width">
                                        <label class="form-label">E-Mail *</label>
                                        <input type="email" class="form-input" id="studentEmail" required>
                                    </div>
                                    <div class="form-field">
                                        <label class="form-label">Studiengang *</label>
                                        <select class="form-select" id="studentProgram" required>
                                            <option value="">Bitte wählen</option>
                                            <option value="1">BSc Wirtschaftsinformatik</option>
                                        </select>
                                    </div>
                                    <div class="form-field">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="studentScheinfrei">
                                            <span class="form-label">Scheinfrei</span>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button cancel" onclick="closeModal('addStudentModal')">Abbrechen</button>
                            <button class="modal-button primary" onclick="document.getElementById('addStudentForm').requestSubmit()">Anlegen</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function openAddThesisModal() {
            alert('Arbeit anlegen - Modal wird noch implementiert');
        }

        function openAddProfessorModal() {
            alert('Professor anlegen - Modal wird noch implementiert');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.remove();
        }

        async function submitNewStudent(event) {
            event.preventDefault();

            const newStudent = {
                vorname: document.getElementById('studentFirstName').value,
                nachname: document.getElementById('studentLastName').value,
                mail: document.getElementById('studentEmail').value,
                scheinfrei: document.getElementById('studentScheinfrei').checked,
                idStudiengang: parseInt(document.getElementById('studentProgram').value)
            };

            try {
                const response = await fetch(`${API_BASE_URL}/students`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newStudent)
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                await loadStudents();
                renderStudentsList(AppState.students);
                updateStudentsStats();
                closeModal('addStudentModal');
                updateStatus('Student erfolgreich angelegt');
            } catch (error) {
                console.error('Error creating student:', error);
                document.getElementById('errorMessage').innerHTML = `<div class="error-message">${error.message}</div>`;
            }
        }

        async function deleteStudent(matrikelnummer) {
            if (!confirm('Student wirklich löschen?')) return;

            try {
                const response = await fetch(`${API_BASE_URL}/students/${matrikelnummer}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                await loadStudents();
                renderStudentsList(AppState.students);
                updateStudentsStats();
                document.getElementById('studentDetails').className = 'details-panel empty';
                document.getElementById('studentDetails').textContent = 'Wählen Sie einen Studenten aus der Liste aus';
                updateStatus('Student gelöscht');
            } catch (error) {
                console.error('Error deleting student:', error);
                alert('Fehler beim Löschen: ' + error.message);
            }
        }

        // ==================== UTILITY FUNCTIONS ====================

        function updateStatus(message) {
            const now = new Date();
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            document.getElementById('statusText').textContent = `${message} | ${timeStr} Uhr`;
        }

        // ==================== NAVIGATION ====================

        document.addEventListener('click', e => {
        const link = e.target.closest('[data-view]');
        if (!link) return;

        e.preventDefault();
        const viewName = link.dataset.view;
        if (!viewName) return;

        ViewManager.render(viewName);
        });

        // ==================== INITIALIZATION ====================

        ViewManager.render('dashboard');
    </script>
</body>
</html>